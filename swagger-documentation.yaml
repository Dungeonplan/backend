openapi: 3.0.0
info:
  version: '1.0'
  title: Dungeonplan
  description: Backend API
paths:
  /api/logindiscord:
    get:
      summary: Redirect to Discord SSO
      tags:
        - OAuth2
        - Discord
      responses:
        '307':
          description: Redirect to Discord SSO server.
  /api/logindiscordcallback:
    get:
      summary: Callback address for Discord SSO.
      parameters:
        - in: query
          name: state
          schema:
            type: string
          description: Unique code generated by API
        - in: query
          name: code
          schema:
            type: string
          description: Code from successful login with Discord
      tags:
        - OAuth2
        - Discord
      responses:
        '307':
          description: Redirect to Dungeonplan after successful or failed login
  /api/tokenexchange:
    post:
      summary: Endpoint to transform discord token to jwt token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenexchangeRequest'
      tags:
        - Authorization
        - OAuth2
      responses:
        '401':
          description: Token not found, Token already used, Token was expired
        '200':
          description: New JWT Token was successfully created and returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenexchangeResponse'
  /api/logout:
    get:
      summary: Endpoint to invalidate a jwt token.
      security:
        - BearerAuth: []
      tags:
        - Authorization
      responses:
        '401':
          description: No or invalid JWT Token was transmitted
        '200':
          description: Invalidation/Logout was successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
  /api/version:
    get:
      summary: Endpoint to get current version (will be removed on productive)
      tags:
        - misc
      responses:
        '200':
          description: Version could be retrieved
          content:
            applicatio/json:
              schema:
                $ref: '#/components/schemas/VersionResponse'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
  schemas:
    TokenexchangeRequest:
      properties:
        token:
          type: string
          example: '4hHAGFLbSstOeHSEwmdRSSK7F3lZynFT'
    TokenexchangeResponse:
      properties:
        token:
          type: string
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c'
        user_actions:
          type: array
          items:
            $ref: '#/components/schemas/UserAction'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
    UserAction:
      properties:
        id:
          type: integer
          example: 0
        short_name:
          type: string
          example: 'can_kill_unicorns'
        description:
          type: string
          example: 'User is authorized to kill unicorns.'
    Role:
      properties:
        id:
          type: integer
          example: 0
        short_name:
          type: string
          example: 'admin'
        description:
          type: string
          example: 'Global Admin role.'
        hierarchy:
          type: integer
          example: 0
        system:
          type: boolean
          example: true
    VersionResponse:
      properties:
        version:
          type: string
          example: "1.0"
        build:
          type: integer
          example: 1337
    SuccessResponse:
      properties:
        success:
          type: boolean
          example: true
        description:
          type: string
          example: 'Action was successful.'